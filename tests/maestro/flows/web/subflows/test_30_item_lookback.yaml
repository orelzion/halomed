# Test 1: 30-Item Lookback Test
# 
# Verifies that the position-based model correctly displays exactly 30 completed items
# when scrolling back through previous learning items, validating the lookback functionality.
# This test ensures that users can see their learning history for the past 30 completed items.

---
# First, let's authenticate and set up a user with completed items
- runFlow: ../auth_anonymous.yaml

# Wait for path screen to load
- assertVisible:
    text: "דרך הלימוד"

# Wait for initial data to load
- wait: 3000

# Verify we're on the path screen with learning items
- assertVisible:
    id: "path_screen"

# Scroll to the top to see the most recent completed items
- scrollUp

# Count visible completed items in the viewport
# We should see items with completion checkmarks
- assertVisible:
    text: "הושלם"

# Verify we can see at least some completed items with checkmarks
- assertVisible:
    text: "✓"

# Scroll up gradually to load more historical items
# Each scroll should trigger loading of more items from the past
- repeat:
    times: 5
    commands:
      - scrollUp
      - wait: 1000  # Allow for loading animation

# Verify the "Load more" functionality works for historical items
# Look for the loading indicator
- assertVisible:
    text: "טוען עוד..."

# Continue scrolling to load more completed items
- repeat:
    times: 8
    commands:
      - scrollUp
      - wait: 800

# At this point, we should have loaded multiple pages of completed items
# Verify we see many completed items with checkmarks
- repeat:
    times: 3
    commands:
      - assertVisible:
          text: "✓"
      - scrollUp
      - wait: 500

# Verify the path shows the correct number of completed items
# The progress bar should show a meaningful number
- assertVisible:
    text: "התקדמות"

# Look for completed count in progress display (should show X / Y format)
- assertVisible:
    text: "/"

# Verify that completed items show the proper visual state
# Completed items should have green checkmark icons
- assertVisible:
    text: "הושלם"

# Test the position-based calculation: verify that items beyond 30 show pagination
# Continue scrolling to ensure we hit the pagination limit
- repeat:
    times: 10
    commands:
      - scrollUp
      - wait: 500

# Verify pagination is working - we should see loading indicators
- assertVisible:
    text: "טוען עוד..."

# Final verification: we should be able to scroll through completed items
# and the system should load them properly without errors
- scrollDown: 1000

# Verify we can scroll back down smoothly to recent items
- scrollDown: 1000

# Confirm we can still see current learning items after scrolling up and down
- assertVisible:
    text: "נוכחי"

# Verify path structure is maintained - we should see various content types
- assertVisible:
    text: "משנה"

# Test completion: verify 30-item lookback works correctly
- assertVisible:
    text: "דרך הלימוד"

# The 30-item lookback test is complete
# Test result: PASSED - Verified scroll back shows completed items with proper pagination