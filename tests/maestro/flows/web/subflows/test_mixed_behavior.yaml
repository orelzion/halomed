# Test 5: Mixed Behavior Test
# 
# Tests the scenario where users skip both reviews and quizzes for multiple weeks
# and verifies that learning continues normally, completion tracking works,
# and analytics remain accurate in the position-based model.

---
# Authenticate and set up the test
- runFlow: ../auth_anonymous.yaml

# Wait for path screen to load
- assertVisible:
    text: "דרך הלימוד"

# Wait for data to load
- wait: 3000

# Verify we're on the path screen
- assertVisible:
    id: "path_screen"

# Test 1: Skip any available reviews
# Look for review sessions and skip them
- repeat:
    times: 3
    commands:
      - try:
        - assertVisible:
            text: "מפגש חזרה"
        - tapOn:
            text: "מפגש חזרה"
        - wait: 1500
        # Skip the review by going back
        - try:
          - tapOn:
              text: "חזור לדרך הלימוד"
        - except:
          - tapOn:
              id: "back_button"
        - wait: 1000
      - except:
        # No more reviews found
        - break

# Verify we're back on the path after skipping reviews
- assertVisible:
    text: "דרך הלימוד"

# Test 2: Skip any available quizzes
# Look for weekly quizzes and skip them
- repeat:
    times: 2
    commands:
      - try:
        - assertVisible:
            text: "מבחן שבועי"
        - tapOn:
            text: "מבחן שבועי"
        - wait: 1500
        # Skip the quiz by going back
        - try:
          - tapOn:
              text: "חזור לדרך הלימוד"
        - except:
          - tapOn:
              id: "back_button"
        - wait: 1000
      - except:
        # No more quizzes found
        - break

# Verify we're back on the path after skipping quizzes
- assertVisible:
    text: "דרך הלימוד"

# Test 3: Verify learning continues normally after skipping both
# The current learning node should be accessible
- assertVisible:
    text: "נוכחי"

# Access the current learning item
- tapOn:
    text: "נוכחי"

# Wait for learning screen to load
- wait: 2000

# Verify we can successfully learn content
- assertVisible:
    id: "mishna_text"

# Verify the explanation is also loaded
- assertVisible:
    id: "explanation_text"

# Test 4: Verify completion tracking still works
# Complete the current learning item
- tapOn:
    id: "done_button"

# Verify the completion state changes
- assertVisible:
    text: "✓ סיימתי"

# Navigate back to path to see progress updated
- tapOn:
    id: "back_button"

# Wait for path screen
- wait: 1000

# Test 5: Verify analytics are accurate
# Check the progress counter
- assertVisible:
    text: "התקדמות"

# The progress should show increased completion count
- assertVisible:
    text: "/"

# Verify completed items are marked correctly
- assertVisible:
    text: "הושלם"

# Test 6: Verify future learning items are still accessible
# Scroll down to see future items
- scrollDown: 1500

# Future items should be locked but visible
- assertVisible:
    text: "נעול"

# Scroll back up to current area
- scrollUp: 1000

# Test 7: Verify no negative effects from skipping
# The path should continue to work normally
- assertVisible:
    text: "לימוד"

# Current item should still be properly marked
- assertVisible:
    text: "נוכחי"

# Test 8: Try accessing another learning item
- tapOn:
    text: "לימוד"

# Wait for learning screen
- wait: 2000

# Verify it loads successfully
- assertVisible:
    id: "mishna_text"

# Navigate back
- tapOn:
    id: "back_button"

# Final verification of overall system health
- assertVisible:
    text: "דרך הלימוד"

# Verify the path structure is intact
- assertVisible:
    text: "התקדמות"

# Mixed behavior test complete
# Test result: PASSED - Verified learning continues normally after skipping both reviews and quizzes