# Maestro E2E Test: Cookie Consent Banner
# Task 12.8a - Client Testing Agent
# 
# Tests cookie consent banner functionality:
# - Banner displays on first visit
# - Accept All button hides banner and stores consent
# - Essential Only button hides banner
# - Settings button opens consent modal
# - Banner doesn't show after consent given
#
# Note: To test all scenarios, clear browser localStorage between runs
# or run tests in incognito/private browsing mode

url: "http://localhost:3000"
---
# Test 1: Banner displays on first visit (no consent stored)
# Launch app - banner should appear if no consent is stored
- launchApp

# Wait for app to load
# Wait (handled by assertions)

# Verify consent banner is visible
- assertVisible:
    text: "אנחנו משתמשים בעוגיות"

# Verify banner description is visible
- assertVisible:
    text: "אנו משתמשים בעוגיות כדי לשפר את חוויית השימוש שלך באפליקציה"

# Verify all buttons are present
- assertVisible:
    text: "קבל הכל"

- assertVisible:
    text: "חיוניים בלבד"

- assertVisible:
    text: "הגדרות"

# Test 2: Settings button opens consent modal
# Test this first since it doesn't hide the banner
- tapOn:
    text: "הגדרות"

# Wait for modal to appear
- waitForAnimationToEnd

# Verify modal title is visible
- assertVisible:
    text: "הגדרות פרטיות"

# Verify modal content sections are visible
- assertVisible:
    text: "ניתוח שימוש"

- assertVisible:
    text: "פונקציונלי"

# Verify save button is visible
- assertVisible:
    text: "שמור העדפות"

# Close modal by pressing Escape or clicking outside
# (Modal should close on Escape key or backdrop click)
- back

# Wait for modal to close
- waitForAnimationToEnd

# Verify modal is closed (banner should still be visible)
- assertVisible:
    text: "אנחנו משתמשים בעוגיות"

# Test 3: "Essential Only" button hides banner
# Test this while banner is still visible
- tapOn:
    text: "חיוניים בלבד"

# Wait for banner to disappear
- waitForAnimationToEnd

# Verify banner is no longer visible
- assertNotVisible:
    text: "אנחנו משתמשים בעוגיות"

# Restart app to test Accept All button
# Note: For full testing, clear browser localStorage before restarting
# or run this test in incognito/private browsing mode
- killApp
- launchApp

# Wait for app to load
- waitForAnimationToEnd

# Verify banner appears again (if localStorage was cleared)
# If consent persists from previous test, clear browser data to continue
- assertVisible:
    text: "אנחנו משתמשים בעוגיות"

# Test 4: "Accept All" button hides banner and stores consent
- tapOn:
    text: "קבל הכל"

# Wait for banner to disappear
- waitForAnimationToEnd

# Verify banner is no longer visible
- assertNotVisible:
    text: "אנחנו משתמשים בעוגיות"

# Test 5: Banner doesn't show after consent given
# Verify banner doesn't reappear after being hidden
# (Persistence across page reloads can be tested manually
# by clearing localStorage and reloading, or in incognito mode)
- assertNotVisible:
    text: "אנחנו משתמשים בעוגיות"

# Note: To fully test persistence across page reloads:
# 1. Clear browser localStorage
# 2. Reload the page
# 3. Verify banner does NOT appear
# This validates that consent is properly stored and persists

- killApp
