<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaLomeid Tasks - Trello Board</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f4f5f7;
            padding: 20px;
            color: #172b4d;
        }

        .header {
            background: #026aa7;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header .subtitle {
            opacity: 0.9;
            font-size: 14px;
        }

        .board {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 20px;
        }

        .column {
            background: #ebecf0;
            border-radius: 8px;
            padding: 12px;
            min-width: 300px;
            max-width: 300px;
            flex-shrink: 0;
        }

        .column-header {
            font-weight: 600;
            font-size: 14px;
            padding: 8px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .column.done .column-header {
            color: #5e6c84;
        }

        .column.in-progress .column-header {
            color: #f39c12;
        }

        .column.todo .column-header {
            color: #2980b9;
        }

        .card {
            background: white;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 8px;
            box-shadow: 0 1px 0 rgba(9, 30, 66, 0.25);
            cursor: pointer;
            transition: all 0.2s;
        }

        .card:hover {
            background: #f4f5f7;
            box-shadow: 0 2px 4px rgba(9, 30, 66, 0.15);
        }

        .card.completed {
            opacity: 0.8;
        }

        .card-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            color: #172b4d;
        }

        .card-details {
            font-size: 12px;
            color: #5e6c84;
            line-height: 1.5;
        }

        .card-details ul {
            margin-left: 16px;
            margin-top: 4px;
        }

        .card-details li {
            margin-bottom: 4px;
        }

        .card-meta {
            font-size: 11px;
            color: #6b778c;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #ebecf0;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 4px;
        }

        .badge.complete {
            background: #61bd4f;
            color: white;
        }

        .badge.pending {
            background: #dfe1e6;
            color: #42526e;
        }

        .badge.test {
            background: #0052cc;
            color: white;
        }

        .stats {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 0 rgba(9, 30, 66, 0.25);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: #026aa7;
        }

        .stat-label {
            font-size: 12px;
            color: #6b778c;
            margin-top: 4px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b778c;
        }

        .error {
            background: #eb5a46;
            color: white;
            padding: 16px;
            border-radius: 4px;
            margin: 20px 0;
        }

        .category-header {
            font-weight: 600;
            font-size: 12px;
            color: #5e6c84;
            margin-top: 16px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-header:first-child {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìã HaLomeid Backend Tasks</h1>
        <div class="subtitle">Trello-style Board View</div>
    </div>

    <div id="loading" class="loading">Loading tasks...</div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="board" class="board" style="display: none;"></div>
    <div id="stats" class="stats" style="display: none;"></div>

    <script>
        // Parse markdown tasks.md and render as Trello board
        async function loadTasks() {
            try {
                const response = await fetch('tasks.md');
                if (!response.ok) {
                    throw new Error(`Failed to load tasks.md: ${response.status}`);
                }
                const text = await response.text();
                const tasks = parseTasks(text);
                renderBoard(tasks);
                renderStats(tasks);
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 
                    `Error: ${error.message}. Make sure tasks.md is in the same directory and you're serving this file via a local server (e.g., python -m http.server 8000)`;
            }
        }

        function parseTasks(markdown) {
            const tasks = {
                done: [],
                inProgress: [],
                todo: []
            };

            const lines = markdown.split('\n');
            let currentCategory = '';
            let currentSubCategory = '';
            let currentTask = null;
            let taskDetails = [];
            let collectingDetails = false;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const trimmed = line.trim();

                // Skip empty lines when not collecting details
                if (!trimmed && !collectingDetails) {
                    continue;
                }

                // Detect main category headers (##)
                if (line.startsWith('## ')) {
                    currentCategory = line.replace('## ', '').trim();
                    currentSubCategory = '';
                    continue;
                }

                // Detect subcategory headers (###)
                if (line.startsWith('### ')) {
                    currentSubCategory = line.replace('### ', '').trim();
                    continue;
                }

                // Detect task items
                const taskMatch = trimmed.match(/^- \[([ x])\] \*\*(Task \d+\.\d+)\*\*: (.+?)(?:\s+‚úÖ)?(?:\s+\((\d{4}-\d{2}-\d{2})\))?/);
                if (taskMatch) {
                    // Save previous task if exists
                    if (currentTask) {
                        currentTask.details = taskDetails.join('\n');
                        addTask(currentTask, tasks);
                    }

                    const isComplete = taskMatch[1] === 'x';
                    const taskId = taskMatch[2];
                    const title = taskMatch[3];
                    const date = taskMatch[4] || '';

                    currentTask = {
                        id: taskId,
                        title: title,
                        completed: isComplete,
                        date: date,
                        category: currentSubCategory || currentCategory,
                        details: ''
                    };
                    taskDetails = [];
                    collectingDetails = true;
                    continue;
                }

                // Collect task details (indented lines starting with -)
                if (currentTask && collectingDetails) {
                    if (line.startsWith('  - ') || line.startsWith('    - ')) {
                        // Remove leading spaces and dashes
                        const detail = line.replace(/^\s*-\s*/, '').trim();
                        if (detail) {
                            taskDetails.push(detail);
                        }
                        continue;
                    }
                    
                    // Stop collecting if we hit another task or category
                    if (trimmed.startsWith('- [') || trimmed.startsWith('##') || trimmed.startsWith('###')) {
                        collectingDetails = false;
                        if (currentTask) {
                            currentTask.details = taskDetails.join('\n');
                            addTask(currentTask, tasks);
                            currentTask = null;
                            taskDetails = [];
                        }
                        // Process this line in next iteration
                        i--;
                        continue;
                    }
                    
                    // Stop collecting on empty line if next line is not a detail
                    if (!trimmed) {
                        if (i + 1 < lines.length) {
                            const nextLine = lines[i + 1].trim();
                            if (!nextLine.startsWith('  -') && !nextLine.startsWith('    -')) {
                                collectingDetails = false;
                                if (currentTask) {
                                    currentTask.details = taskDetails.join('\n');
                                    addTask(currentTask, tasks);
                                    currentTask = null;
                                    taskDetails = [];
                                }
                            }
                        }
                    }
                }
            }

            // Save last task
            if (currentTask) {
                currentTask.details = taskDetails.join('\n');
                addTask(currentTask, tasks);
            }

            return tasks;
        }

        function addTask(task, tasks) {
            if (task.completed) {
                tasks.done.push(task);
            } else {
                // Check if task mentions "in progress" or has partial completion
                const details = task.details.toLowerCase();
                if (details.includes('in progress') || details.includes('pending')) {
                    tasks.inProgress.push(task);
                } else {
                    tasks.todo.push(task);
                }
            }
        }

        function renderBoard(tasks) {
            document.getElementById('loading').style.display = 'none';
            const board = document.getElementById('board');
            board.style.display = 'flex';

            // Group done tasks by category
            const doneByCategory = {};
            tasks.done.forEach(task => {
                if (!doneByCategory[task.category]) {
                    doneByCategory[task.category] = [];
                }
                doneByCategory[task.category].push(task);
            });

            // Done column
            const doneColumn = createColumn('‚úÖ DONE', 'done', tasks.done.length);
            Object.keys(doneByCategory).forEach(category => {
                if (category) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'category-header';
                    categoryDiv.textContent = category;
                    doneColumn.appendChild(categoryDiv);
                }
                doneByCategory[category].forEach(task => {
                    doneColumn.appendChild(createCard(task, true));
                });
            });
            board.appendChild(doneColumn);

            // In Progress column
            const inProgressColumn = createColumn('üîÑ IN PROGRESS', 'in-progress', tasks.inProgress.length);
            tasks.inProgress.forEach(task => {
                inProgressColumn.appendChild(createCard(task, false));
            });
            board.appendChild(inProgressColumn);

            // To Do column
            const todoColumn = createColumn('üìã TO DO', 'todo', tasks.todo.length);
            const todoByCategory = {};
            tasks.todo.forEach(task => {
                if (!todoByCategory[task.category]) {
                    todoByCategory[task.category] = [];
                }
                todoByCategory[task.category].push(task);
            });
            Object.keys(todoByCategory).forEach(category => {
                if (category) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'category-header';
                    categoryDiv.textContent = category;
                    todoColumn.appendChild(categoryDiv);
                }
                todoByCategory[category].forEach(task => {
                    todoColumn.appendChild(createCard(task, false));
                });
            });
            board.appendChild(todoColumn);
        }

        function createColumn(title, className, count) {
            const column = document.createElement('div');
            column.className = `column ${className}`;
            
            const header = document.createElement('div');
            header.className = 'column-header';
            header.textContent = `${title} (${count})`;
            column.appendChild(header);

            return column;
        }

        function createCard(task, isCompleted) {
            const card = document.createElement('div');
            card.className = `card ${isCompleted ? 'completed' : ''}`;

            const title = document.createElement('div');
            title.className = 'card-title';
            title.innerHTML = `<strong>${task.id}</strong> - ${task.title}`;
            card.appendChild(title);

            if (task.details) {
                const details = document.createElement('div');
                details.className = 'card-details';
                const detailsList = task.details.split('\n').filter(d => d.trim());
                if (detailsList.length > 0) {
                    const ul = document.createElement('ul');
                    detailsList.forEach(detail => {
                        const li = document.createElement('li');
                        // Handle markdown formatting
                        let text = detail
                            .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                            .replace(/`(.+?)`/g, '<code>$1</code>');
                        li.innerHTML = text;
                        ul.appendChild(li);
                    });
                    details.appendChild(ul);
                }
                card.appendChild(details);
            }

            const meta = document.createElement('div');
            meta.className = 'card-meta';
            if (task.date) {
                meta.innerHTML = `<span class="badge ${isCompleted ? 'complete' : 'pending'}">${isCompleted ? '‚úÖ' : '‚è≥'}</span> ${task.date}`;
            }
            if (task.details && task.details.toLowerCase().includes('test')) {
                meta.innerHTML += ' <span class="badge test">Tests</span>';
            }
            card.appendChild(meta);

            return card;
        }

        function renderStats(tasks) {
            const stats = document.getElementById('stats');
            stats.style.display = 'block';

            const total = tasks.done.length + tasks.inProgress.length + tasks.todo.length;
            const completionRate = total > 0 ? Math.round((tasks.done.length / total) * 100) : 0;

            stats.innerHTML = `
                <h3>üìä Progress Summary</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${tasks.done.length}</div>
                        <div class="stat-label">Done</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${tasks.inProgress.length}</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${tasks.todo.length}</div>
                        <div class="stat-label">To Do</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${completionRate}%</div>
                        <div class="stat-label">Complete</div>
                    </div>
                </div>
            `;
        }

        // Load tasks on page load
        loadTasks();
    </script>
</body>
</html>
